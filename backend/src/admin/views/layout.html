<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 Helldivers 2 - Admin Panel</title>
    <link rel="stylesheet" href="/admin/assets/css/admin.css?v=3.2">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎮</text></svg>">
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="Painel administrativo do Helldivers 2 API">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>🎮 Carregando Admin Panel</h2>
            <p>Inicializando interface administrativa modular...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <h1 class="header-title">
                    <span class="header-icon">🎮</span>
                    Helldivers 2 Admin
                </h1>
                <span class="header-subtitle">Painel Administrativo v3.2 (Modular)</span>
            </div>
            <div class="header-right">
                <div class="header-info">
                    <span id="userInfo" class="user-info">👤 Carregando...</span>
                    <span id="envInfo" class="env-info">🌐 Carregando...</span>
                </div>
                <div class="header-actions">
                    <button id="refreshBtn" class="btn btn-outline" title="Atualizar dados">
                        🔄 Atualizar
                    </button>
                    <a href="/admin/logout" class="btn btn-danger" title="Sair do admin">
                        🚪 Logout
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="admin-nav">
        <div class="nav-content">
            <div class="nav-links">
                <a href="/admin/" class="nav-link active" data-section="dashboard">
                    📊 Dashboard
                </a>
                <a href="/api/docs" class="nav-link" target="_blank">
                    📚 API Docs
                </a>
                <a href="/" class="nav-link" target="_blank">
                    🏠 Site Principal
                </a>
            </div>
            <div class="nav-stats">
                <span id="totalItems" class="nav-stat">
                    📦 Total: <span class="stat-value">-</span>
                </span>
                <span id="lastUpdate" class="nav-stat">
                    🕒 Atualizado: <span class="stat-value">-</span>
                </span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="admin-main">
        <div class="main-content">
            {{CONTENT}}
        </div>
    </main>

    <!-- Footer -->
    <footer class="admin-footer">
        <div class="footer-content">
            <div class="footer-left">
                <p>&copy; 2025 Helldivers 2 Admin Panel</p>
                <span class="footer-separator">|</span>
                <span id="buildInfo">Build: v3.2 (Modular)</span>
            </div>
            <div class="footer-right">
                <span id="connectionStatus" class="connection-status">
                    🟢 Conectado
                </span>
                <span class="footer-separator">|</span>
                <span id="currentTime" class="current-time">--:--:--</span>
            </div>
        </div>
    </footer>

    <!-- Global Notifications -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmTitle">Confirmar Ação</h3>
                <button id="confirmModalClose" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Tem certeza que deseja continuar?</p>
            </div>
            <div class="modal-footer">
                <button id="confirmCancel" class="btn btn-secondary">
                    Cancelar
                </button>
                <button id="confirmButton" class="btn btn-danger">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Processando...</p>
        </div>
    </div>

    <!-- 
    ===== SCRIPTS MODULARES - ORDEM IMPORTANTE =====
    
    IMPORTANTE: Os scripts devem ser carregados nesta ordem específica:
    1. Core (funcionalidades básicas)
    2. Utils (utilitários e UI) 
    3. Dashboard (estatísticas e visualização)
    4. Models (CRUD dos modelos)
    5. Main (arquivo principal que integra tudo)
    
    MUDANÇA CRÍTICA: Alterado de /public/js/ para /admin/assets/js/
    -->
    
    <!-- 1. Core - Funcionalidades básicas -->
    <script src="/admin/assets/js/admin-core.js?v=3.2"></script>
    
    <!-- 2. Utils - Utilitários e UI -->
    <script src="/admin/assets/js/admin-utils.js?v=3.2"></script>
    
    <!-- 3. Dashboard - Estatísticas e visualização -->
    <script src="/admin/assets/js/admin-dashboard.js?v=3.2"></script>
    
    <!-- 4. Models - CRUD dos modelos -->
    <script src="/admin/assets/js/admin-models.js?v=3.2"></script>
    
    <!-- 5. Main - Arquivo principal integrador -->
    <script src="/admin/assets/js/admin.js?v=3.2"></script>
    
    <!-- Debug Script (apenas para desenvolvimento) -->
    <script>
        // Debug helper global
        window.AdminDebugHelper = {
            checkModules() {
                const modules = {
                    AdminCore: {
                        loaded: !!window.AdminCore,
                        type: typeof window.AdminCore,
                        methods: window.AdminCore ? Object.getOwnPropertyNames(window.AdminCore.prototype) : []
                    },
                    AdminUtils: {
                        loaded: !!window.AdminUtils,
                        type: typeof window.AdminUtils,
                        methods: window.AdminUtils ? Object.getOwnPropertyNames(window.AdminUtils.prototype) : []
                    },
                    AdminDashboard: {
                        loaded: !!window.AdminDashboard,
                        type: typeof window.AdminDashboard,
                        methods: window.AdminDashboard ? Object.getOwnPropertyNames(window.AdminDashboard.prototype) : []
                    },
                    AdminModels: {
                        loaded: !!window.AdminModels,
                        type: typeof window.AdminModels,
                        methods: window.AdminModels ? Object.getOwnPropertyNames(window.AdminModels.prototype) : []
                    }
                };
                
                console.table(modules);
                return modules;
            },
            
            testInstantiation() {
                console.log('🧪 Testando criação de instâncias...');
                const results = {};
                
                try {
                    const core = new window.AdminCore();
                    results.AdminCore = { success: true, instance: !!core };
                } catch (e) {
                    results.AdminCore = { success: false, error: e.message };
                }
                
                try {
                    const utils = new window.AdminUtils();
                    results.AdminUtils = { success: true, instance: !!utils };
                } catch (e) {
                    results.AdminUtils = { success: false, error: e.message };
                }
                
                try {
                    const dashboard = new window.AdminDashboard();
                    results.AdminDashboard = { success: true, instance: !!dashboard };
                } catch (e) {
                    results.AdminDashboard = { success: false, error: e.message };
                }
                
                try {
                    const models = new window.AdminModels();
                    results.AdminModels = { success: true, instance: !!models };
                } catch (e) {
                    results.AdminModels = { success: false, error: e.message };
                }
                
                console.table(results);
                return results;
            }
        };

        // Verificação de carregamento dos módulos
        window.addEventListener('load', function() {
            console.log('📦 Verificando módulos após load...');
            const modules = window.AdminDebugHelper.checkModules();
            
            const allLoaded = Object.values(modules).every(module => module.loaded);
            if (allLoaded) {
                console.log('✅ Todos os módulos carregados com sucesso!');
                
                // Teste de instanciação
                setTimeout(() => {
                    window.AdminDebugHelper.testInstantiation();
                }, 100);
            } else {
                console.warn('⚠️ Alguns módulos não foram carregados');
                
                // Mostrar quais falharam
                Object.entries(modules).forEach(([name, info]) => {
                    if (!info.loaded) {
                        console.error(`❌ ${name} não carregado`);
                    }
                });
            }
        });

        // Tratamento de erros para debugging
        let errorCount = 0;
        window.addEventListener('error', function(e) {
            errorCount++;
            console.error(`🐛 Erro JS #${errorCount}:`, {
                message: e.message,
                source: e.filename,
                line: e.lineno,
                col: e.colno,
                stack: e.error?.stack
            });
            
            // Se muitos erros, sugerir reload
            if (errorCount > 5) {
                console.warn('⚠️ Muitos erros detectados. Considere recarregar a página.');
            }
        });
        
        // Log de início
        console.log('📄 Layout modular carregado - aguardando scripts...');
        console.log('🔧 Debug helper disponível em: window.AdminDebugHelper');
    </script>
</body>
</html>